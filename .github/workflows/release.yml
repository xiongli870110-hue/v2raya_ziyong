name: Build and Release v2rayA Bundle

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-v2raya:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Prepare bundle directory
      run: |
        mkdir -p bundle/v2ray-core

    - name: Download v2rayA binary (x64)
      run: |
        wget -O bundle/v2raya_linux_x64_2.2.7.3 https://github.com/v2rayA/v2rayA/releases/download/v2.2.7.3/v2raya_linux_x64_2.2.7.3
        chmod +x bundle/v2raya_linux_x64_2.2.7.3

    - name: Download v2ray-core binary
      run: |
        wget -O v2ray.zip https://github.com/v2fly/v2ray-core/releases/latest/download/v2ray-linux-64.zip
        unzip -o v2ray.zip -d bundle/v2ray-core
        chmod +x bundle/v2ray-core/v2ray

    - name: Download geoip.dat and geosite.dat
      run: |
        wget -O bundle/v2ray-core/geoip.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat
        wget -O bundle/v2ray-core/geosite.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat

    - name: Package bundle
      run: |
        tar -czvf v2rayA-bundle.tar.gz -C bundle .

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v2rayA-bundle-v2.2.7.3
        name: "v2rayA Bundle v2.2.7.3"
        body: |
          ✅ Includes v2rayA x64 binary  
          ✅ Includes v2ray-core binary  
          ✅ Includes geoip.dat and geosite.dat  
          ✅ Compatible with offline installation script
        files: v2rayA-bundle.tar.gz
      env:
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
