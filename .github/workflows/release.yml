name: Release v2rayA Core Bundle

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-and-release:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Prepare bundle structure
      run: |
        mkdir -p bundle/usr/local/bin
        mkdir -p bundle/usr/local/share/v2ray

    - name: Download v2ray-core and extract
      run: |
        wget -O v2ray.zip https://github.com/v2fly/v2ray-core/releases/latest/download/v2ray-linux-64.zip
        unzip -o v2ray.zip -d v2ray
        install -Dm755 v2ray/v2ray bundle/usr/local/bin/v2ray

    - name: Download geoip.dat and geosite.dat
      run: |
        wget -O bundle/usr/local/share/v2ray/geoip.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/download/202511032214/geoip.dat
        wget -O bundle/usr/local/share/v2ray/geosite.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/download/202511032214/geosite.dat

    - name: Download v2rayA binary
      run: |
        wget -O bundle/usr/local/bin/v2raya https://github.com/v2rayA/v2rayA/releases/download/v2.2.7.3/v2raya_linux_x64_2.2.7.3
        chmod +x bundle/usr/local/bin/v2raya

    - name: Package bundle
      run: |
        tar -czvf v2rayA-core-bundle.tar.gz -C bundle .

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v2rayA-core-bundle-v2.2.7.3
        name: "v2rayA Core Bundle v2.2.7.3"
        body: |
          âœ… v2ray-core binary  
          âœ… v2rayA binary  
          âœ… geoip.dat + geosite.dat  
          ğŸ“ å®‰è£…è·¯å¾„æ¨¡æ‹Ÿä¸º /usr/local/bin å’Œ /usr/local/share/v2ray  
          ğŸ“¦ å¯ç”¨äºç¦»çº¿éƒ¨ç½²æˆ–è‡ªåŠ¨å®‰è£…è„šæœ¬
        files: v2rayA-core-bundle.tar.gz
      env:
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
